<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Invoice | M&M Kid's Wear</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:Inter;
  background:#f5f7fb;
  color:#0f172a;
}
header{
  background:#0f172a;
  color:#fff;
  padding:16px 24px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.container{
  max-width:900px;
  margin:20px auto;
}
.card{
  background:#fff;
  padding:24px;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.06);
}
.row{
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
}
hr{
  margin:20px 0;
  border:none;
  border-top:1px solid #e5e7eb;
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:10px;
  border-bottom:1px solid #e5e7eb;
  text-align:left;
}
th{
  background:#f1f5f9;
}
.total{
  font-size:20px;
  font-weight:700;
}
button{
  padding:10px 14px;
  border:none;
  border-radius:10px;
  font-weight:600;
  cursor:pointer;
}
.primary{background:#2563eb;color:#fff}
.secondary{background:#e5e7eb}

/* PRINT STYLE */
@media print {
  header, button {
    display: none !important;
  }
  body {
    background:#fff;
  }
  .card {
    box-shadow:none;
    border-radius:0;
  }
  table th {
    background:#eee !important;
  }
}
</style>
</head>

<body>

<header>
  <strong>M&M Kid's Wear Invoice</strong>
  <div>
    <button class="secondary" onclick="window.print()">Print</button>
    <button class="primary" onclick="downloadPDF()">Download PDF</button>
  </div>
</header>

<div class="container">
  <div class="card">
    <h2>Invoice</h2>

    <div class="row">
      <div>
        <strong>Order ID:</strong> <span id="orderId"></span><br>
        <strong>Date:</strong> <span id="orderDate"></span>
      </div>
      <div>
        <strong>Status:</strong> <span id="orderStatus"></span><br>
        <strong>Payment:</strong> <span id="paymentMethod"></span>
      </div>
    </div>

    <hr>

    <h3>Shipping Address</h3>
    <p id="address"></p>

    <hr>

    <h3>Items</h3>
    <table>
      <thead>
        <tr>
          <th>Product</th>
          <th>Qty</th>
          <th>Price</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody id="items"></tbody>
    </table>

    <hr>

    <div class="row">
      <span>Subtotal</span>
      <span id="subtotal"></span>
    </div>
    <div class="row">
      <span>CGST (9%)</span>
      <span id="cgst"></span>
    </div>
    <div class="row">
      <span>SGST (9%)</span>
      <span id="sgst"></span>
    </div>
    <div class="row">
      <span>Shipping</span>
      <span id="shipping"></span>
    </div>
    <div class="row">
      <span>Discount</span>
      <span id="discount"></span>
    </div>
    <div class="row total">
      <span>Total</span>
      <span id="total"></span>
    </div>

  </div>
</div>

<script>
const API = "http://localhost:5000";
const token = localStorage.getItem("token");

if (!token) location.href = "login.html";

const orderIdParam = new URLSearchParams(location.search).get("id");

async function loadInvoice(){
  const res = await fetch(API + "/api/orders/" + orderIdParam, {
    headers: { Authorization: token }
  });
  const o = await res.json();

  orderId.innerText = o._id;
  orderDate.innerText = new Date(o.createdAt).toDateString();
  orderStatus.innerText = o.status;
  paymentMethod.innerText = o.paymentMethod;

  address.innerText =
`${o.shippingAddress.name}
${o.shippingAddress.phone}
${o.shippingAddress.addressLine1}
${o.shippingAddress.city}, ${o.shippingAddress.state} - ${o.shippingAddress.pincode}`;

  items.innerHTML = "";
  o.items.forEach(i=>{
    items.innerHTML += `
      <tr>
        <td>${i.name}</td>
        <td>${i.quantity}</td>
        <td>₹${i.price}</td>
        <td>₹${i.price * i.quantity}</td>
      </tr>`;
  });

  subtotal.innerText = "₹" + o.subtotal;
  cgst.innerText = "₹" + (o.gst?.cgst || 0);
  sgst.innerText = "₹" + (o.gst?.sgst || 0);
  shipping.innerText = "₹" + o.shippingCharge;
  discount.innerText = "-₹" + o.discount;
  total.innerText = "₹" + o.totalAmount;

  showNotification("Invoice ready");
}

function downloadPDF(){
  window.open(API + "/api/orders/invoice/" + orderIdParam);
}

/* WEBSITE NOTIFICATION */
function showNotification(msg){
  const n = document.createElement("div");
  n.style.position = "fixed";
  n.style.bottom = "20px";
  n.style.right = "20px";
  n.style.background = "#16a34a";
  n.style.color = "#fff";
  n.style.padding = "12px 18px";
  n.style.borderRadius = "10px";
  n.style.fontWeight = "600";
  n.innerText = msg;
  document.body.appendChild(n);
  setTimeout(()=>n.remove(), 3000);
}

loadInvoice();
</script>

</body>
</html>
