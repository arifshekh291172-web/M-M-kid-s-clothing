<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>My Wishlist | M&M Kid's Wear</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Playfair+Display:wght@600;700&display=swap"
        rel="stylesheet">

    <!-- Google Material Icons (Modern) -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,500,1,0"
        rel="stylesheet" />

    <!-- Main CSS -->
    <link rel="stylesheet" href="style.css">

    <style>
        .material-icon {
            font-family: 'Material Symbols Rounded';
            font-size: 22px;
            vertical-align: middle;
        }

        .nav-link {
            gap: 6px;
        }

        .wishlist-btn {
            background: var(--white);
            color: #ef4444;
        }

        .wishlist-btn:hover {
            background: #ef4444;
            color: #fff;
        }
    </style>
</head>

<body>

    <!-- ================= HEADER ================= -->
    <header>
        <div class="header-main">
            <div class="container">
                <div class="nav-wrapper">

                    <a href="index.html" class="logo">
                        <span class="logo-icon">S</span>tyleHub
                    </a>

                    <div class="nav-actions">
                        <a href="index.html" class="nav-link">
                            <span class="material-icon">home</span> Home
                        </a>

                        <a href="wishlist.html" class="nav-link">
                            <span class="material-icon">favorite</span> Wishlist
                        </a>

                        <a href="my-orders.html" class="nav-link">
                            <span class="material-icon">local_shipping</span> Orders
                        </a>
                    </div>

                </div>
            </div>
        </div>
    </header>

    <!-- ================= MAIN ================= -->
    <main class="container" style="margin-top:30px;">

        <div class="section-header">
            <h2 class="section-title">
                <span class="material-icon">favorite</span> My Wishlist
            </h2>
        </div>

        <!-- EMPTY WISHLIST -->
        <div class="empty-cart" id="emptyWishlist" style="display:none;">
            <div class="empty-cart-icon">
                <span class="material-icon" style="font-size:80px;color:#ef4444;">
                    favorite
                </span>
            </div>
            <h3>Your wishlist is empty</h3>
            <p>Add items you love ❤️</p>
            <br>
            <a href="index.html" class="buy-now-btn" style="display:inline-block;padding:12px 30px;">
                Continue Shopping
            </a>
        </div>

        <!-- WISHLIST GRID -->
        <div class="products-grid" id="wishlistGrid"></div>

    </main>

    <!-- ================= FOOTER ================= -->
    <footer>
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2024 M&M Kid's Wear. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- ================= SCRIPT ================= -->
    <script>
        const API = "https://m-m-kid-s-clothing.onrender.com";
        const token = localStorage.getItem("token");

        /* LOGIN CHECK */
        if (!token) {
            window.location.href = "login.html";
        }

        /* LOAD WISHLIST */
        async function loadWishlist() {
            const res = await fetch(API + "/api/wishlist", {
                headers: { Authorization: token }
            });
            const data = await res.json();

            const grid = document.getElementById("wishlistGrid");
            const empty = document.getElementById("emptyWishlist");

            if (!data.success || data.wishlist.products.length === 0) {
                empty.style.display = "block";
                grid.style.display = "none";
                return;
            }

            empty.style.display = "none";
            grid.style.display = "grid";

            grid.innerHTML = data.wishlist.products.map(p => `
    <div class="product-card">

      <div class="product-image-wrapper">
        <img src="${p.image}" class="product-image">

        <button class="wishlist-btn"
          onclick="removeFromWishlist('${p._id}')"
          title="Remove from wishlist">
          <span class="material-icon">favorite</span>
        </button>
      </div>

      <div class="product-info">
        <div class="product-brand">${p.brand}</div>
        <h3 class="product-name">${p.name}</h3>

        <div class="product-price">
          <span class="current-price">₹${p.price}</span>
          ${p.originalPrice ? `<span class="original-price">₹${p.originalPrice}</span>` : ""}
        </div>

        <div class="product-actions">
          <button class="add-to-cart-btn"
            onclick="moveToCart('${p._id}')">
            <span class="material-icon">shopping_cart</span>
            Move to Cart
          </button>
        </div>
      </div>

    </div>
  `).join("");
        }

        /* REMOVE FROM WISHLIST */
        async function removeFromWishlist(productId) {
            await fetch(API + "/api/wishlist/" + productId, {
                method: "DELETE",
                headers: { Authorization: token }
            });
            loadWishlist();
        }

        /* MOVE TO CART */
        async function moveToCart(productId) {
            await fetch(API + "/api/cart/add", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: token
                },
                body: JSON.stringify({ productId, quantity: 1 })
            });

            await removeFromWishlist(productId);
        }

        /* INIT */
        loadWishlist();
    </script>

</body>

</html>